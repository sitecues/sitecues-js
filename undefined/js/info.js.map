{"version":3,"sources":["../../config-wrap-start-default.js","info/info.js","../../../../../../module-create.js"],"names":["sitecues","define","$","site","urls","dimmer","platform","locale","colorUtil","events","ids","nativeGlobal","inlineStyle","addCloseButtonTimer","$iframe","$closeButton","MAX_ZINDEX","INITIAL_CSS","position","left","top","width","height","transform","willChange","backgroundColor","borderRadius","transition","opacity","zIndex","ENLARGED_CSS","BUTTON_SIZE","CLOSE_BUTTON_CSS","cursor","border","background","fontSize","fontFamily","display","lineHeight","margin","INITIAL_DELAY","INFLATION_SPEED","DIMMER_SPEED","isModalOpen","getBorderCss","isOnDarkBackground","document","body","close","set","setTimeout","remove","window","off","removeEventListener","checkCloseMessage","enableScrolling","enableWebPagePointerEvents","undimBackgroundContent","removeCloseButton","onload","iframe","contentWindow","focus","ex","one","addEventListener","showModal","pageName","anchor","localizedPageName","getUiLocale","sitecuesJsUrl","getRawScriptUrl","hostUrl","location","pageUrl","resolveResourceUrl","scUrl","siteId","getSiteId","siteUrl","protocol","hostname","port","sessionId","pageViewId","prefs","localStorage","emit","attr","appendTo","dimBackgroundContent","iframeEl","addCloseButton","evt","data","helpRect","getBoundingClientRect","offsetLeft","browser","isMS","offsetTop","right","clearTimeout","doEnable","collection","override","get","pointerEvents","docElem","documentElement","restoreLast","overflowX","overflowY","showHelp","jumpToAnchor"],"mappings":"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","file":"info.js.map","sourcesContent":["\"use strict\";\n","sitecues.define(\n  'info/info',[\n    '$',\n    'run/conf/site',\n    'run/conf/urls',\n    'hlb/dimmer',\n    'run/platform',\n    'run/locale',\n    'page/util/color',\n    'run/events',\n    'run/util/ids',\n    'mini-core/native-global',\n    'run/inline-style/inline-style'\n  ],\n  function (\n    $,\n    site,\n    urls,\n    dimmer,\n    platform,\n    locale,\n    colorUtil,\n    events,\n    ids,\n    nativeGlobal,\n    inlineStyle\n  ) {\n  'use strict';\n\n  var $iframe = $(),\n    $closeButton = $(),\n    MAX_ZINDEX = 2147483647,\n    INITIAL_CSS = {\n      position: 'fixed',\n      left: '15%',\n      top: '10%',\n      width: '70%',\n      height: '80%',\n      transform: 'scale3d(.7,.7,1)',\n      willChange: 'transform',\n      backgroundColor: '#fff',\n      borderRadius: '8px',\n      transition: 'opacity .9s, transform 1s',\n      opacity: 0,\n      zIndex: MAX_ZINDEX\n    },\n    ENLARGED_CSS = {\n      opacity: 1,\n      transform: 'scale(1)'\n    },\n    BUTTON_SIZE = 60,\n    CLOSE_BUTTON_CSS = {\n      cursor: 'pointer',\n      border: '3px solid #ccc',\n      borderRadius: '48px',\n      background: '#222',\n      fontSize: '54px',\n      fontFamily: 'Verdana',\n      display: 'block',\n      lineHeight: '0px',\n      position: 'fixed',\n      zIndex: MAX_ZINDEX,\n      margin: '8px',\n      width: BUTTON_SIZE + 'px',\n      height: BUTTON_SIZE + 'px',\n      opacity: 0,\n      transition: 'opacity 200ms'\n    },\n    INITIAL_DELAY = 100,\n    INFLATION_SPEED = 1000,\n    DIMMER_SPEED = 500,\n    addCloseButtonTimer,\n    isModalOpen = false;\n\n  function getBorderCss() {\n    // Use adaptive border that is visible on any background\n    return colorUtil.isOnDarkBackground(document.body) ? '7px solid #fff' : '20px solid #000';\n  }\n\n  function close() {\n    inlineStyle.set($iframe[0], INITIAL_CSS);\n    nativeGlobal.setTimeout(function() {\n      $iframe.remove();\n      $iframe = $();\n      isModalOpen = false;\n    }, INFLATION_SPEED);\n\n    $(window)\n      .off('focus', close);\n\n    window.removeEventListener('message', checkCloseMessage);\n\n    enableScrolling(true);\n\n    enableWebPagePointerEvents(true);\n\n    dimmer.undimBackgroundContent(DIMMER_SPEED);\n\n    removeCloseButton();\n  }\n\n  function onload() {\n    // Try to focus iframe\n    nativeGlobal.setTimeout(function () {\n      var iframe = $iframe[0];\n      try {\n        iframe.contentWindow.focus();\n      }\n      catch (ex) {}\n\n      $(window).one('focus', close);\n\n      window.addEventListener('message', checkCloseMessage);\n    }, 0);\n\n  }\n\n  function showModal(pageName, anchor) {\n\n    if (isModalOpen) {\n      return;\n    }\n\n    var\n      localizedPageName = pageName + '-' + locale.getUiLocale(),\n      sitecuesJsUrl = urls.getRawScriptUrl(),\n      hostUrl = window.location,\n      pageUrl = urls.resolveResourceUrl('html/help/' + localizedPageName + '.html',\n        {\n          scUrl: sitecuesJsUrl,\n          siteId: site.getSiteId(),\n          siteUrl: hostUrl.protocol + '//' + hostUrl.hostname + ':' + hostUrl.port,\n          sessionId: ids.sessionId,\n          pageViewId: ids.pageViewId,\n          prefs: window.localStorage.sitecues\n        });\n\n    events.emit('info/did-show');\n\n    $iframe = $('<iframe>')\n      .attr('src', pageUrl + anchor);\n\n    inlineStyle.set($iframe[0], INITIAL_CSS);\n    inlineStyle($iframe[0]).border = getBorderCss();\n\n    $iframe\n      .one('load', onload)\n      .appendTo('html');\n\n    // Prevent panning in background content\n\n    enableWebPagePointerEvents(false);\n\n    enableScrolling(false);\n\n    dimmer.dimBackgroundContent(DIMMER_SPEED, $iframe);\n\n    nativeGlobal.setTimeout(function () {\n      inlineStyle.set($iframe[0], ENLARGED_CSS);\n      var iframeEl = $iframe[0];\n      if (iframeEl.contentWindow) {\n        iframeEl.contentWindow.focus();\n      }\n      else {\n        iframeEl.focus();\n      }\n    }, INITIAL_DELAY); // Waiting helps animation performance\n\n    addCloseButtonTimer = nativeGlobal.setTimeout(addCloseButton, INITIAL_DELAY + INFLATION_SPEED + 100);\n\n    isModalOpen = true;\n  }\n\n  function checkCloseMessage(evt) {\n    if (evt.data === 'sc-close-iframe') {\n      close();\n    }\n  }\n\n  function addCloseButton() {\n    var\n      helpRect = $iframe[0].getBoundingClientRect(),\n      offsetLeft = platform.browser.isMS ? -30 : -17, // Deal with big scrollbars on Windows\n      offsetTop = platform.browser.isMS ? -6 : -1;\n\n    $closeButton =\n      $('<scx style=\"display:block\" class=\"scp-hand-cursor\"><scx style=\"position:relative;left:14px;top:23px;color:#ccc\">x</scx></scx>');\n    inlineStyle.set($closeButton[0], CLOSE_BUTTON_CSS);\n    inlineStyle.set($closeButton[0], {\n        left: (helpRect.right - BUTTON_SIZE / 2 + offsetLeft) + 'px',  // Subtracts border width as well\n        top: (helpRect.top - BUTTON_SIZE / 2 + offsetTop) + 'px'\n    });\n    $closeButton\n        .appendTo('html')\n        .one('click', close);\n\n    addCloseButtonTimer = nativeGlobal.setTimeout(function () {\n      inlineStyle($closeButton[0]).opacity = '1';\n    }, 100);\n  }\n\n  function removeCloseButton() {\n    $closeButton.remove();\n    if (addCloseButtonTimer) {\n      clearTimeout(addCloseButtonTimer);\n    }\n    addCloseButtonTimer = 0;\n  }\n\n  function enableWebPagePointerEvents(doEnable) {\n    var collection = $('body,#scp-bp-container');\n    inlineStyle.override(collection.get(), {\n      pointerEvents : doEnable ? '' : 'none'\n    });\n  }\n\n  function enableScrolling(doEnable) {\n    var docElem = document.documentElement;\n    if (doEnable) {\n      inlineStyle.restoreLast(docElem, ['overflow-x', 'overflow-y']);\n    }\n    else {\n      inlineStyle.override(docElem, {\n        overflowX : 'hidden',\n        overflowY : 'hidden'\n      });\n    }\n  }\n\n  // jumpTo can be to a named anchor or id in the document, e.g. #keyboard\n  function showHelp(jumpToAnchor) {\n    showModal('help', jumpToAnchor || '');\n  }\n\n  return {\n    showHelp: showHelp\n  };\n});\n\n","\nsitecues.define(\"info\", function(){});\n"]}