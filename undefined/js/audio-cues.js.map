{"version":3,"sources":["../../config-wrap-start-default.js","audio-cues/audio-cues.js","../../../../../../module-create.js"],"names":["sitecues","define","pref","audio","HIGH_ZOOM_THRESHOLD","DESCRIPTIVE_HIGH_ZOOM_PARAM","CUE_RESET_MS","DESCRIPTIVE_SPEECH_ON_PARAM","VERBAL_CUE_SPEECH_ON","VERBAL_CUE_SPEECH_ON_DESCRIPTIVE","VERBAL_CUE_SPEECH_OFF","shouldPlayDescriptiveSpeechOnCue","firstSpeechOn","get","Date","now","shouldPlayDescriptiveHighZoomCue","zoom","lastDescriptiveZoomCueTime","parseInt","playSpeechCue","isEnabled","speakCueByName","set","playZoomCue"],"mappings":"AAAA;;;;;;ACKAA,SAAAC,OACA,2BACA,wBACA,iBAEA,SACAC,MACAC;;EAKA,IAAAC,sBAAA;EAEAC,8BAAA;EAGAC,eAAA;;EAGAC,8BAAA,iBAEAC,uBAAA,qBACAC,mCAAA,0BACAC,wBAAA;;;;;EAMA,SAAAC;IACA,IAAAC,gBAAAV,KAAAW,IAAAN;IACA,QAAAK,iBAAAA,gBAAAN,eAAAQ,KAAAC;;;;;EAMA,SAAAC,iCAAAC;;IAEA,IAAAA,QAAAb,qBAAA;MACA,IAAAc,6BAAAC,SAAAjB,KAAAW,IAAAR;MACA,QAAAa,8BAAAJ,KAAAC,QAAAG,6BAAAZ;;;;;;EAOA,SAAAc,cAAAC;IAEA,KAAAA,WAAA;;MAEAlB,MAAAmB,eAAAZ;MACA;;;;;;;IAQA,KAAAC;MACAR,MAAAmB,eAAAd;WACA;MACAL,MAAAmB,eAAAb;;MAEAP,KAAAqB,IAAAhB,6BAAAO,KAAAC;;;EAIA,SAAAS,YAAAP;;;;IAIA,IAAAD,iCAAAC,OAAA;MACAd,MAAAmB,eAAA;;MAEApB,KAAAqB,IAAAlB,6BAAAS,KAAAC;;;EAIA;IACAK,eAAAA;IACAI,aAAAA;;;;ACxFAxB,SAAAC,OAAA,cAAA","file":"audio-cues.js.map","sourcesContent":["\"use strict\";\n","/**\n * This is the audio cue library.  It listens to sitecues events and plays appropriate verbal cues.\n * Not to be confused with earcons, which are just sounds.\n */\n\nsitecues.define(\n  'audio-cues/audio-cues',[\n    'run/conf/preferences',\n    'audio/audio'\n  ],\n  function (\n    pref,\n    audio\n  ) {\n  'use strict';\n\n  // The high zoom threshold for the zoom-based verbal cue\n  var HIGH_ZOOM_THRESHOLD = 1.6,\n    // Tracks the last time the user has heard the \"descriptive high zoom\" cue.\n    DESCRIPTIVE_HIGH_ZOOM_PARAM = 'firstHighZoom',\n\n    // Time in millis after which cues should replay.\n    CUE_RESET_MS = 7 * 86400000, // 7 days\n\n    // Tracks the last time the user has heard the longer, more descriptive \"speech on\" cue.\n    DESCRIPTIVE_SPEECH_ON_PARAM ='firstSpeechOn',\n\n    VERBAL_CUE_SPEECH_ON = 'verbalCueSpeechOn',\n    VERBAL_CUE_SPEECH_ON_DESCRIPTIVE = 'verbalCueSpeechOnFirst',\n    VERBAL_CUE_SPEECH_OFF = 'verbalCueSpeechOff';\n\n  /**\n   * Returns true if the \"descriptive speech on\" cue should be played.\n   * @return {boolean}\n   */\n  function shouldPlayDescriptiveSpeechOnCue() {\n    var firstSpeechOn = pref.get(DESCRIPTIVE_SPEECH_ON_PARAM);\n    return !firstSpeechOn || firstSpeechOn + CUE_RESET_MS < Date.now();\n  }\n\n  /**\n   * Returns true if the description of one-touch-read should be played after a zoom change\n   */\n  function shouldPlayDescriptiveHighZoomCue(zoom) {\n    // If zoom isn't high enough, or hasn't increased beyond initial setting, don't play cue\n    if (zoom >= HIGH_ZOOM_THRESHOLD) {\n      var lastDescriptiveZoomCueTime = parseInt(pref.get(DESCRIPTIVE_HIGH_ZOOM_PARAM));\n      return !lastDescriptiveZoomCueTime || Date.now() - lastDescriptiveZoomCueTime > CUE_RESET_MS;\n    }\n  }\n\n  /*\n   * Play speech on cue if necessary\n   */\n  function playSpeechCue(isEnabled) {\n\n    if (!isEnabled) {\n      // *** Speech off cue ***\n      audio.speakCueByName(VERBAL_CUE_SPEECH_OFF);\n      return;\n    }\n\n    // EQ-996 - As a user, I want multiple chances to learn about the\n    // spacebar command so that I can benefit from One Touch Read\n    //---------------------------------------------------------------------------------------------------//\n    // 1) For the TTS-spacebar hint (currently given when TTS is turned on the first time):\n    // Give the hint max three times, or until the user successfully uses the spacebar once with TTS on.\n    if(!shouldPlayDescriptiveSpeechOnCue()) {\n      audio.speakCueByName(VERBAL_CUE_SPEECH_ON);\n    } else {\n      audio.speakCueByName(VERBAL_CUE_SPEECH_ON_DESCRIPTIVE);\n      // Signals that the \"descriptive speech on\" cue has played\n      pref.set(DESCRIPTIVE_SPEECH_ON_PARAM, Date.now());\n    }\n  }\n\n  function playZoomCue(zoom) {\n    // If highlighting is enabled, zoom is large enough, zoom is larger\n    // than we started, and we haven't already cued, then play an audio\n    // cue to explain highlighting\n    if (shouldPlayDescriptiveHighZoomCue(zoom)) {\n      audio.speakCueByName('verbalCueHighZoom');\n      // Signals that the \"descriptive high zoom\" cue has played.\n      pref.set(DESCRIPTIVE_HIGH_ZOOM_PARAM, Date.now());\n    }\n  }\n\n  return {\n    playSpeechCue: playSpeechCue,\n    playZoomCue: playZoomCue\n  };\n});\n\n","\nsitecues.define(\"audio-cues\", function(){});\n"]}